!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var r in i)("object"==typeof exports?exports:e)[r]=i[r]}}(this,function(){return function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){function i(e,t){var i=this;if(!e)throw new Error("Sorry!no files upload");t=t||{},i.defaults={width:null,height:null,fieldName:"file",quality:.7},i.file=e;for(var r in t)t.hasOwnProperty(r)&&(i.defaults[r]=t[r]);return i.init()}function r(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return new window.Blob([r.buffer],{type:i})}i.prototype.init=function(){var e=this,t=e.file,i="string"==typeof t,n=/^data:/.test(t),o=new Image,a=document.createElement("canvas"),l=null;if(e._fileToDataURL().then(function(t){l=t,e.blob=l,o.src=l,e.img=o}),e.canvas=a,i?e.fileName=n?"base64.jpg":t.split("/").pop():e.fileName=t.name,!document.createElement("canvas").getContext)throw new Error("浏览器不支持canvas");return new Promise(function(i,n){o.onerror=function(){var e=new Error("加载图片失败");throw n(e),e},o.onload=function(){e._getBase64().then(function(e){if(e.length<10){var t=new Error("Create Base64 error!");throw n(t),t}return e}).then(function(n){var o=new FormData;t="object"==typeof e.file&&n.length>e.file.size?e.file:r(n),o.append(e.defaults.fieldName,t,e.fileName.replace(/\..+/g,".jpg")),i({formData:o,fileLen:t.size,base64:n,origin:e.file,file:t,compressRate:(t.size/e.file.size).toFixed(2)});for(var a in e)e.hasOwnProperty(a)&&(e[a]=null);try{URL.revokeObjectURL(e.blob)}catch(e){var l=new Error("Global variable URL is polluted");throw console.log(e),l}})}})},i.prototype._getBase64=function(){var e=this,t=e.canvas;return new Promise(function(i){e.resize=e._getResize(),e.ctx=t.getContext("2d"),t.width=e.resize.width,t.height=e.resize.height,e.ctx.fillStyle="#fff",e.ctx.fillRect(0,0,t.width,t.height),e._createBase64().then(i)})},i.prototype._createBase64=function(){var e=this,t=e.resize,i=e.img,r=e.canvas,n=e.ctx,o=e.defaults;return n.drawImage(i,0,0,t.width,t.height),new Promise(function(e){e(r.toDataURL("image/jpeg",o.quality))})},i.prototype._getResize=function(){var e=this,t=e.img,i=e.defaults,r=i.width,n=i.height,o={width:t.width,height:t.height};if(o.width<r||o.height<n)return o;var a=o.width/o.height;return r&&n?a>=r/n?o.width>r&&(o.width=r,o.height=Math.ceil(r/a)):o.height>n&&(o.height=n,o.width=Math.ceil(n*a)):r?r<o.width&&(o.width=r,o.height=Math.ceil(r/a)):n&&n<o.height&&(o.width=Math.ceil(n*a),o.height=n),o},i.prototype._fileToDataURL=function(){var e=this,t=e.file,i=e.fileIsString;return new Promise(function(e){i&&e(t);try{e(URL.createObjectURL(t))}catch(i){var r=new FileReader;r.readAsDataURL(t),r.onload=function(){e(this.result)}}})},window.WebUploadImg=function(e,t){return new i(e,t)},e.exports=window.WebUploadImg}])});